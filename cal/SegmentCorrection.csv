#######################################################################################
# Author: Mark Bandstra	2010/2/28, 2010/3/26, 2010/4/20, 2010/7/12
# This file is based on corrections used by others:
#    Event time correction: Jau-Shian Liang
#    CL rollover correction: Jau-Shian Liang
#    PC time to GPS correction: Alan Chiu
#
# How to use this file to correct NCT 2009 flight data:
# (1) Use the Frame Counter of the event (FC) and the Unix time of the event (TI)
#     to find the appropriate line in this file (call it line j).
#     TI must fall between TI_Start[j] and TI_End[j] and FC must fall between
#     FC_Start[j] and FC_End[j].
#     If the event does not fit within one of the segments listed in this file,
#     that means there is no valid correction for that event yet.
#
# (2) Apply the CL offset to CL, given the detector number:
#
#        CL = CL - CL_Offset_D#[j]
#        CL = CL mod 2^32
#
# (3) Calculate the unrolled CL time (CL_unrolled):
#
#        TI_period = 2^32/10^7 (sec)
#        CL_period = 2^32
#        n = (TI-TI_0[j])/TI_period + CL_0/CL_period
#        n_rollovers = floor(n)
#        f = n-n_rollovers
#      (Fix problems that occur in a TI when a rollover occurs:)
#        if (CL<1.4e9 and f>0.7):  n_rollovers += 1
#        if (CL>2.9e9 and f<0.3):  n_rollovers -= 1
#        CL_unrolled = CL + n_rollovers*CL_period
#
# (4) Calculate the corrected event time (TC): 
#
#         TC = TI_0[j] + A_0[j] + A_1[j]*(CL_unrolled-CL_0[j])/10^7
#
#     Note that the linear coefficients A_0 and A_1 should be ~0 and ~1.00, respectively.
#
# (5) The corrected event time TC can then be used to interpolate from the aspect files,
#     within the range between GCUHK_Start[j] and GCUHK_End[j].
#
# (6) Calculate the GPS time of the event using the PC time to GPS time correction:
#
#         T_GPS = TC + B_0[j] + B_1[j]*(TC-TI_0_GPS[j]) + B_2[j]*(TC-TI_0_GPS[j])^2
#
# (7) Calculate Universal Time (UT) of the event:
#
#         UT = T_GPS-LEAPSECONDS
#
#     Note that all times (including UT here) are in the Unix Epoch (i.e., seconds since 1 Jan 1970 00:00).
#     The MJD of the start of the Unix Epoch is 40587.0.  LEAPSECONDS is not provided in this file.
#
# Columns:
# 0:      [Segment_Name],
# 1,2:    [TI_Start], [TI_End],
# 3,4:    [Frame_Counter_Start], [Frame_Counter_End],
# 5,6:    [GCUHK_Start], [GCUHK_End],
# 7-10:   [TI_0], [CL_0], [A_0], [A_1],
# 11-14:  [TI_0_GPS], [B_0], [B_1], [B_2], 
# 15-24:  [CL_Offset_D0], [CL_Offset_D1], [CL_Offset_D2], [CL_Offset_D3], [CL_Offset_D4],
#         [CL_Offset_D5], [CL_Offset_D6], [CL_Offset_D7], [CL_Offset_D8], [CL_Offset_D9]
#
#######################################################################################
# [Name], [TI_Start], [TI_End], [FC_Start], [FC_End], [GCUHK_Start], [GCUHK_End], [TI_0], [CL_0], [A_0], [A_1], [TI_0_GPS], [B_0], [B_1], [B_2], [CL_D0], [CL_D1], [CL_D2], [CL_D3], [CL_D4], [CL_D5], [CL_D6], [CL_D7], [CL_D8], [CL_D9]
 A, 1242564271, 1242572066,        0,  6731346,     0,  6692,    1242564271,          0,  0.0000000000, 1.0000000000,   1242564271, -2.8394125461e+01, -4.8590822633e-04, -3.4249642329e-08,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
B1, 1242572067, 1242592669,        0, 12896216,  6693, 23875,    1242572067,  672985895, -0.0415093867, 1.0005919549,   1242572036, -4.0017485891e+00, -4.6374669059e-04, -6.1962941502e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
B2, 1242593153, 1242596295, 13123719, 14626718,  6693, 23875,    1242593153,  295424871,  0.3445180469, 1.0007742313,   1242572036, -4.0017485891e+00, -4.6374669059e-04, -6.1962941502e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
 C, 1242596329, 1242596936, 14643589, 14905309, 23900, 24335,    1242596329, 1961281185, -0.1881178422, 1.0009563042,   1242596329, -4.0704132090e+00, -5.1199716957e-04,  0.0000000000e+00,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
D1, 1242596937, 1242600881, 14920664, 16777214, 24336, 36944,    1242596937,  294769315, -0.4623089113, 1.0007935558,   1242596937, -1.9426901111e+01, -7.8779087352e-04, -1.1444535519e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
D2, 1242600881, 1242601821,        1,   445677, 24336, 36944,    1242600881, 1047222007, -0.6380175597, 1.0008518904,   1242596937, -1.9426901111e+01, -7.8779087352e-04, -1.1444535519e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
D3, 1242601859, 1242605957,   449801,  2386199, 24336, 36944,    1242601859,   74247984, -0.1640843307, 1.0008079275,   1242596937, -1.9426901111e+01, -7.8779087352e-04, -1.1444535519e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
D4, 1242605957, 1242610050,  2386719,  4235555, 24336, 36944,    1242605958, 2375571217, -0.0896240509, 1.0008199629,   1242596937, -1.9426901111e+01, -7.8779087352e-04, -1.1444535519e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
D5, 1242610075, 1242612559,  4239273,  5257640, 24336, 36944,    1242610075,   52881307, -0.1301040951, 1.0008214184,   1242596937, -1.9426901111e+01, -7.8779087352e-04, -1.1444535519e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
D6, 1242612578, 1242614682,  5258800,  6018790, 24336, 36944,    1242612578,      63630,  0.4482212475, 1.0008505047,   1242596937, -1.9426901111e+01, -7.8779087352e-04, -1.1444535519e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
E1, 1242614682, 1242629778,  6029166, 11419972, 36945, 49080,    1242614682, 4140755995,  0.4759915818, 1.0007574879,   1242614682, -3.6973679828e+00, -8.3255486554e-04, 5.7106473294e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
E2, 1242629809, 1242631574, 11421270, 12050207, 36945, 49080,    1242629809,     214309,  0.7994573983, 1.0006203115,   1242614682, -3.6973679828e+00, -8.3255486554e-04, 5.7106473294e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
F1, 1242652660, 1242660046,   148016,  3330643, 49090, 61807,    1242652660,  1831430652, -0.8722122810, 1.0005504340,   1242649963, -2.4229081545e+01, -7.2678177345e-04, 1.2620783422e-08,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
F2, 1242660056, 1242661841,  3331053,  4409981, 49090, 61807,    1242660056,     247442, -5.0588149269, 1.0006800321,   1242649963, -2.4229081545e+01, -7.2678177345e-04, 1.2620783422e-08,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
F3, 1242661852, 1242666066,  4410384,  6425197, 49090, 61807,    1242661852,      31115, -4.9577908826, 1.0005823574,   1242649963, -2.4229081545e+01, -7.2678177345e-04, 1.2620783422e-08,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
 G, 1242666036, 1242669492,  6425198,  7977221, 61808, 64727,    1242666036, 3508357396, -0.2471713328, 1.0006131988,   1242666036, -3.0955566665e+00, -5.5287837213e-04, -5.7058826460e-09,    0, 0, 0, 0, 0, 0, 0, 0, 0, 0
 H, 1242670598, 1242674163,    71632,  1230071, 64733, 68039,    1242670598,   28668370,  1.2077581408, 1.0006312358,   1242670598, -2.5408971839e+01, -6.8342593671e-04,  0.0000000000e+00,    0, 2034103823, 271573469, 191053741, 3702575617, 152087359, 96634949, 63824424, 30038450, 0